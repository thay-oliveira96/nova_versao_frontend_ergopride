<div class="departamento-container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="header-content">
      <div class="title-section">
        <mat-icon class="title-icon">business</mat-icon>
        <h1>Gerenciamento de Departamentos</h1>
      </div>
      <button mat-raised-button color="primary" (click)="showCreateForm()" class="add-button">
        <mat-icon>add</mat-icon>
        Novo Departamento
      </button>
    </div>
  </div>

  <!-- Form Section -->
  <div class="form-section" *ngIf="showForm">
    <mat-card class="form-card">
      <mat-card-header>
        <mat-card-title>{{ editingId ? 'Editar' : 'Novo' }} Departamento</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <form [formGroup]="departamentoForm" (ngSubmit)="onSubmit()" class="form">
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Nome do Departamento</mat-label>
              <input matInput formControlName="nome" placeholder="Ex: Recursos Humanos">
              <mat-error *ngIf="departamentoForm.get('nome')?.hasError('required')">
                {{ getErrorMessage('nome') }}
              </mat-error>
              <mat-error *ngIf="departamentoForm.get('nome')?.hasError('minlength')">
                {{ getErrorMessage('nome') }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Descrição</mat-label>
              <textarea matInput formControlName="descricao" rows="3" 
                        placeholder="Descreva as responsabilidades do departamento"></textarea>
              <mat-error *ngIf="departamentoForm.get('descricao')?.hasError('required')">
                {{ getErrorMessage('descricao') }}
              </mat-error>
              <mat-error *ngIf="departamentoForm.get('descricao')?.hasError('minlength')">
                {{ getErrorMessage('descricao') }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Responsável</mat-label>
              <input matInput formControlName="responsavel" placeholder="Nome do responsável">
              <mat-error *ngIf="departamentoForm.get('responsavel')?.hasError('required')">
                {{ getErrorMessage('responsavel') }}
              </mat-error>
              <mat-error *ngIf="departamentoForm.get('responsavel')?.hasError('minlength')">
                {{ getErrorMessage('responsavel') }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-actions">
            <button type="button" mat-button (click)="cancelForm()" class="cancel-button">
              Cancelar
            </button>
            <button type="submit" mat-raised-button color="primary" 
                    [disabled]="departamentoForm.invalid" class="submit-button">
              {{ editingId ? 'Atualizar' : 'Criar' }}
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Data Table Section -->
  <div class="table-section">
    <mat-card class="table-card">
      <mat-card-content>
        <!-- Search and Actions Bar -->
        <div class="table-header">
          <div class="search-section">
            <mat-form-field appearance="outline" class="search-field">
              <mat-label>Buscar departamentos</mat-label>
              <input matInput (keyup)="applyFilter($event)" placeholder="Digite para filtrar...">
              <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>
          </div>
          <div class="table-info">
            <span class="total-count">{{ dataSource.data.length }} departamento(s)</span>
          </div>
        </div>

        <!-- Loading Spinner -->
        <div class="loading-container" *ngIf="loading">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Carregando departamentos...</p>
        </div>

        <!-- Data Table -->
        <div class="table-container" *ngIf="!loading">
          <table mat-table [dataSource]="dataSource" matSort class="data-table">
            <!-- Nome Column -->
            <ng-container matColumnDef="nome">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Nome </th>
              <td mat-cell *matCellDef="let row"> {{ row.nome }} </td>
            </ng-container>

            <!-- Descrição Column -->
            <ng-container matColumnDef="descricao">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Descrição </th>
              <td mat-cell *matCellDef="let row"> {{ row.descricao }} </td>
            </ng-container>

            <!-- Responsável Column -->
            <ng-container matColumnDef="responsavel">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Responsável </th>
              <td mat-cell *matCellDef="let row"> {{ row.responsavel }} </td>
            </ng-container>

            <!-- Data Criação Column -->
            <ng-container matColumnDef="dataCriacao">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Data de Criação </th>
              <td mat-cell *matCellDef="let row"> {{ row.dataCriacao | date:'dd/MM/yyyy' }} </td>
            </ng-container>

            <!-- Ações Column -->
            <ng-container matColumnDef="acoes">
              <th mat-header-cell *matHeaderCellDef> Ações </th>
              <td mat-cell *matCellDef="let row">
                <div class="action-buttons">
                  <button mat-icon-button color="primary" 
                          (click)="showEditForm(row)" 
                          matTooltip="Editar departamento">
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button mat-icon-button color="warn" 
                          (click)="deleteDepartamento(row.id!)" 
                          matTooltip="Excluir departamento">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>

          <!-- Paginator -->
          <mat-paginator [pageSizeOptions]="[5, 10, 25, 50]" 
                         showFirstLastButtons 
                         aria-label="Selecione a página de departamentos">
          </mat-paginator>

          <!-- No Data Message -->
          <div class="no-data" *ngIf="dataSource.data.length === 0">
            <mat-icon>business_off</mat-icon>
            <p>Nenhum departamento encontrado</p>
            <button mat-raised-button color="primary" (click)="showCreateForm()">
              Criar primeiro departamento
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
